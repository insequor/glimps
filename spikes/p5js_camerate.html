<html>
    <head>
        <title>p5.js Camera Example</title>
        <script defer src=https://cdn.JsDelivr.net/npm/p5></script>
        <script defer src=https://cdn.JsDelivr.net/npm/p5/lib/addons/p5.dom.min.js></script>
    </head>
    <body>

    </body>
    <script>
        var video;
        var vScale = 1;
        var scanLine = 0;

        function setup() {
            const cw = 640;
            const ch = 480;
            createCanvas(cw, ch);
            pixelDensity(1);
            video = createCapture(VIDEO);
            video.size(cw/vScale, ch/vScale);
            video.hide();
            //fullscreen(true);
        }

        function draw() {
            background(51);
            image(video, 0, 0, width, width * video.height / video.width);

            video.loadPixels();

            //scan line
            stroke(255);
            line(0, scanLine, width, scanLine);
            scanLine ++;
            if (scanLine == height)
                scanLine = 0;

            if(false){
                for (var y = 0; y < video.height; y++) {
                    for (var x = 0; x < video.width; x++) {
                        var index = (video.width - x + 1 + (y * video.width))*4;
                        var r = video.pixels[index+0];
                        var g = video.pixels[index+1];
                        var b = video.pixels[index+2];

                        var bright = (r+g+b)/3;

                        var w = map(bright, 0, 255, 0, vScale);

                        noStroke();
                        fill(255);
                        rectMode(CENTER);
                        rect(x*vScale, y*vScale, w, w);
                    }
                }
            }
        }

    </script>
</html>